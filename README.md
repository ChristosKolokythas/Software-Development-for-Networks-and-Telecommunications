#ΟΝΟΜΑΤΑ ΟΜΑΔΑΣ
- Περάκης Πολυχρόνης   1115201400336 
- Καπατσούλιας Θεόδωρος  1115201600056 
- Κολοκύθας Χρήστος  1115201700052 
- Ψαρούδης Γιώργος 1115201700198 
- Ντέμου Σταυρούλα-Ευσταθία 1115201700295 


#Edge Server

**Για Calculator**:

_Κάνει υπολογισμό απόστασης:_
-  -> **AlertSignal**: έχει 4 παραμέτρους και 2 περιπτώσεις
1. Το σημείο 2 να μην υπάρχει (Iot2=null) 

	**distance**: δίνει την απόσταση του Android με το σημείο iot1 και την επιστρέφει.
2. Υπάρχουν και τα 2 σημεία (Iot1,Iot2)

	**distance**: δίνει την απόσταση του Android με τα 2 σημεία (με την βοήθεια της μέσης απόστασης των σημείων) και την επιστρέφει.
-  -> **getCentalPoint**: υπολογίζει την μέση απόσταση των 2 σημείων

	1.**lanCentral** υπολογισμός μια νέας lat μέσω των 2 lat των Iot1 και Iot2, η οποία θα αποτελεί τον μέσο όρο των 2 lat
	
	2.**lonCentral** υπολογισμός μια νεας lon μέσω των 2 lon των Iot1 και Iot2, η οποία θα αποτελεί τον μέσο όρο των 2 lon

	3.δίνεται ένα νέο σημείο (εστω p) με τις νέες τιμές στο lat και lon, το οποίο αποτελεί την μέση απόσταση των Iot1 Kai Iot2

-  -> **calculateDistance**: χρησιμοποιήσαμε αυτή που έχει δοθεί στην εκφώνηση.
-  -> **Point**: είναι βοηθητικό για να μην δίνει πολλές συντεταγμένες ώστε να είναι πιο εύκολο για το τι παίρνει (δηλαδή έχει x, y). Αυτό το κάνουμε για να μην έχει ο getCentalPoint 4 παραμέτρους, βάζουμε Point Iot1 στο οποίο έχει 2 παραμέτρους μέσα του (lat, lon) τα αντίστοιχα δηλαδή (χ, y).  



**Για MyCallback**:

->**messageArived**:Αρχικα δημιουργεί ένα MqttClient,μετατρέπει το μήνυμα σε json object και ανάλογα την τιμή της μεταβλητής id(έχουμε ορίσει σαν device id της android συσκευής το 3 και για τις iot1,iot2 το 1 και 2 αντίστοιχα) εκτελείτε διαφορετικό κομμάτι κώδικα.Στην περίπτωση που το id ειναι 3(δηλαδη λαβαμε μήνυμα από την android συσκευη)δημιουργείτε το android point με τις τρέχουσες συντεταγμένες της android συσκευής.Επίσης η μεταβλητή and_flag(αρχικοποιείται ως false ετσι ώστε στην περίπτωση που λάβει μήνυμα ο server απο καποια iot συσκευή με βαθμό κινδύνου (risk) high/medium πρωτα,ενω δεν εχει τιμες για της συντεταγμενες της android συσκευης να μην προσπαθήσει να υπολογίσει την απόσταση μεταξύ iot και android) γινεται true.
Στην περίπτωση που το id ειναι 1 η 2(δηλαδη λαβαμε μηνυμα απο μια iot συσκευη)αν υπάρχουν ενεργοί ασθητήρες αποθηκεύει την τιμή τους στην αντίστοιχη μεταβλητή και υπολογίζει τον βαθμό κινδύνου (risk).Αν η risk ειναι high/medium το iot_flag της συσκευής που έστειλε το μήνυμα
παίρνει την τιμή true αλλιώς παίρνει την τιμή false.Αν η risk ειναι high/medium και το and_flag ειναι true τότε ο MqttClient αφου πρώτα υπολογιστεί η απόσταση της iot συσκευής απο την android(αν το iot_flag της άλλης iot συσκευής είναι false)ή η αποσταση του κέντρου των 2 iot συσκευών απο την android(αν το iot_flag της άλλης iot συσκευής είναι true)  κάνει publish στο κατάλληλο topic(που είναι subscriber η android συσκευή)μήνυμα που περιέχει τον βαθμό επικινδυνότητας και την απόσταση.




**Για Main** :Ορίζουμε τα topics και τον online broker που χρησιμοποιούμε για την επικοινωνία μεταξύ server,iot συσκευών και android.Δημιουργούμε ένα MqttClient ο οποίος κάνει subscribe στα παραπάνω topics και setCallback την MyCallback.



#ServerGui
 

#REST api

**Android Εφαρμογές**

_1. **Εφαρμογή χρήστη**_

Πρόκειται για την εφαρμογή που θα έχει εγκατεστημένη στο κινητό του ο εκάστοτε χρήστης που θέλει να ενημερωθεί για τη περίπτωση ανίχνευσης κάποιου κινδύνου. Με το άνοιγμα της ο χρήστης συνδέεται με τον MQTT server και λαμβάνει οπτικοακουστικής μορφής ειδοποιήσεις για τυχόν κινδύνους.

**Αρχική Οθόνη**

Με το άνοιγμα της εφαρμογής ο χρήστης αντικρίζει την κύρια οθόνη της εφαρμογής στην οποία συναντά τις εξής επιλογές:
Ένα κουμπί Enable/Disable το οποίο σταματάει άμεσα την αποστολή μετρήσεων προς τον server. 
Τις 3 τελείες οι οποίες περιέχουν 2 επιλογές:

	I. Μετάβαση στα Settings.
	II. ‘Εξοδο απο την εφαρμογή. Για την έξοδο από την εφαρμογή εμφανίζεται ένα αναδυόμενο παράθυρο το οποιο ζητάει την επιβεβαιωση του χρηστη για οριστικη διακοπη της εφαρμογης.
	

**Settings menu**

Στο Settings menu έχουμε τις εξής επιλογές:
Edit IP Address: Στο πεδίο αυτό εισάγουμε την IP για την επικοινωνία με τον Edge Server.
Port: Στο πεδίο αυτό εισάγουμε το Port για την επικοινωνία με τον Edge Server.
Manual Location: Το switch αυτό χρησιμοποιείται για την εναλλαγή τρόπου λήψης τοποθεσίας μεταξύ της χρήσης GPS και των 4 προεπιλεγμένων τοποθεσιών.Σε περίπτωση που επιλεχθεί η χειροκίνητη τοποθεσία υπάρχουν 2 ακόμα Settings.
Choose File:Επιλέγει μεταξύ των 2 αρχείων που δίνονται απο την εκφώνηση.
TimeSpace: Επιλέγει το χρονικό διάστημα για το οποίο γίνεται αποστολή των διανυσμάτων των μετρήσεων.

**Έλεγχος σύνδεσης**

Κάθε 10 δευτερόλεπτα η εφαρμογή ελέγχει μέσω του ConnectivityManager εάν είναι συνδεδεμένη στο internet. Σε περίπτωση που εντοπίσει απουσία σύνδεσης εμφανίζει αντίστοιχη ειδοποίηση.

**Λήψη τοποθεσίας**

Όπως αναφέρθηκε προηγουμένως η λήψη της τοποθεσίας γίνεται με δύο τρόπους εναν αυτοματο και εναν χειροκινητο.
Όταν έχει επιλεχθεί ο αυτόματος τρόπος χρησιμοποιείται η υπηρεσία FusedLocationProviderClient για τη λήψη της πραγματικής τοποθεσίας της συσκευής του χρήστη.
Σε περίπτωση επιλογης χειροκίνητης τοποθεσίας η εφαρμογή διαβάζει τα XML αρχεία χρησιμοποιώντας parse της εκφώνησης και αποθηκεύει τα διανύσματα που περιέχουν σε αντίστοιχους πίνακες,απο τους οποίους αντλεί τα δεδομένα που στέλνει στον MQTT Server.



#iot


